<!DOCTYPE html>
<html lang="en-us">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  	<meta property="og:title" content=" Real World Flux Architecture on iOS &middot;  [Thinking inside a large box];" />
  	<meta property="og:site_name" content="[Thinking inside a large box];" />
  	<meta property="og:url" content="http://localhost:1313/post/real-world-flux-ios/" />

    
  	<meta property="og:type" content="article" />

    <meta property="og:article:published_time" content="2016-06-14T10:24:54-08:00" />

    
    

    <div id="navigation-bar">
  <a href="http://localhost:1313/">Blog</a>
  <a href="http://localhost:1313/about">About</a>
  <a href="http://localhost:1313/speaking">Speaking</a>
  
</div>


  <title>
     Real World Flux Architecture on iOS &middot;  [Thinking inside a large box];
  </title>

    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="apple-touch-icon" href="http://localhost:1313/images/apple-touch-icon.png" />
    <link rel="stylesheet" type="text/css" href="http://localhost:1313/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:1313/css/nav.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:1313/css/navigation_bar.css" />
    <link rel="stylesheet" type="text/css" href="http://localhost:1313/css/base_style_tweaks.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400|Inconsolata" />

    
      
          <link href="http://localhost:1313/index.xml" rel="alternate" type="application/rss+xml" title="[Thinking inside a large box];" />
      
      
    
    <meta name="generator" content="Hugo 0.14" />

    <link rel="canonical" href="http://localhost:1313/post/real-world-flux-ios/" />

    

    
</head>
<body class="nav-closed">

  

 <div class="site-wrapper">




	<header class="main-header tag-head" style="background-image: url(http://localhost:1313/images/japan-backdrop.jpg)">

<nav class="main-nav overlay clearfix">
  
      <a class="menu-button" href="http://localhost:1313/" style="float: left;">&lt; Home</a>
  
  
    
      <a class="menu-button icon-feed" href="">&nbsp;&nbsp;Subscribe</a>
    
  
</nav>
<div class="vertical">
    <div class="main-header-content inner">
        <a href="http://localhost:1313/" style="text-decoration: none;"><h1 class="page-title">[Thinking inside a large box];</h1></a>
        <h2 class="page-description">
            
        </h2>
    </div>
</div>
</header>


    


</header>



<main class="content" role="main">

  <article class="post post">
    <header class="post-header">
      <nav class="breadcrumb">
        
        
        
      </nav>


        <h1 class="post-title">Real World Flux Architecture on iOS</h1>
        <small></small>

        <section class="post-meta">
        
          <time class="post-date" datetime="2016-06-14T10:24:54-08:00">
            Jun 14, 2016
          </time>
        
         
        </section>
    </header>

    <section class="post-content">




<p>About half a year ago we started adopting the Flux architecture in the PlanGrid iOS app. This post will discuss our motivation for transitioning from traditional MVC to Flux and will share the experience we have gathered so far.</p>

<h2 id="why-we-transitioned-away-from-mvc:f68a385428b3fd94e51f72ad1f78204c">Why We Transitioned Away from MVC</h2>

<p>To put our decision into context I want to spend a few paragraphs describing some of the challenges the PlanGrid app faces. Some of them are somewhat unique to enterprise software, others might apply to most iOS apps.</p>

<h3 id="we-have-all-the-state:f68a385428b3fd94e51f72ad1f78204c">We Have All the State</h3>

<p>PlanGrid is a fairly complex iOS app. It allows users to view blueprints and to collaborate on them using different types of annotations, issues and attachments.</p>

<p>An important aspect of the app is that it is offline first. Users can interact with all features in the app, whether they have an internet connection or not. This means that we need to store a lot of data &amp; state on the client. We also need to enforce a subset of the business rules locally (e.g. which annotation can a user delete?).</p>

<p>Lastly, while the PlanGrid app runs on both iPad and iPhone, its UI is optmized to make use of the larger available space on tablets. This means that unlike many iPhone apps we often present multiple view controllers at a time. These view controllers tend to share a decent amount of state.</p>

<h3 id="the-state-of-state-management:f68a385428b3fd94e51f72ad1f78204c">The State of State Management</h3>

<p>All of this means that our app puts a lot of effort into managing state. Any mutation within the app results in more or less the following steps:</p>

<ol>
<li>Update local data</li>
<li>Update UI</li>
<li>Update database</li>
<li>Enqueue change that will be sent to server upon available network connection</li>
<li><strong>Notify other controllers about state change</strong></li>
</ol>

<p>Though I plan on covering other aspects of our new architecture in future blog posts, I want to focus on the 5. step today. <em>How should we populate state updates in our app?</em></p>

<p>This is the billion dollar question of mobile app development.</p>

<p>Most iOS engineers, including early developers of the PlanGrid app, come up with the following answers:</p>

<ul>
<li>Delegation</li>
<li>KVO</li>
<li>NSNotificationCenter</li>
<li>Callback Blocks</li>
<li>Using the DB as source of truth</li>
</ul>

<p>All of these approaches can be valid in different scenarios. However, this menu of different options is a big source of inconsistencies in large codebases that have grown over multiple years.</p>

<h3 id="freedom-is-dangerous:f68a385428b3fd94e51f72ad1f78204c">Freedom is Dangerous</h3>

<p>Classic MVC only advocates the separation of data and its representation. With the lack of other architectural guidance, everything else is left up to individual developers.</p>

<p>For the longest time the PlanGrid app (like most iOS apps) didn&rsquo;t have a defined pattern for state management.</p>

<p>Many of the existing state management tools such as delegation and blocks tend to create dependencies between components that might not be desirable - two view controllers quickly can become tightly couple in an attempt to share state updates with each other.</p>

<p>Other tools, such as KVO and Notifications, create invisible dependencies. Using them in a large codebase can quickly lead to code changes that cause unexpected side effects. It is far to easy for a controller to observe details of the model layer which it shouldn&rsquo;t be interested in.</p>

<p>Thorough code reviews &amp; style guides can only do so much, many of these architectural issues start with small inconsistencies and take a long time to evolve into serious problems. With well defined patterns in place it is a lot easier to detect deviations early.</p>

<h3 id="an-architectural-pattern-for-state-management:f68a385428b3fd94e51f72ad1f78204c">An Architectural Pattern for State Management</h3>

<p>One of our most important goals during refactoring the PlanGrid app was putting clear patterns &amp; best practices in place. This would allow future features to be written in a more consistent way and make onboarding of new engineers a lot more efficient.</p>

<p>State management was one of the largest sources of complexity in our app, so we decided to define a pattern that all new features could use going forward.</p>

<p>A lot of the pain we felt in our existing codebase reminded us strongly of the issues that Facebook brought up when they first presented the Flux pattern:</p>

<ul>
<li>Unexpected, Cascading State Updates</li>
<li>Hard to Understand Dependencies Between Components</li>
<li>Tangled Flow of Information</li>
<li>Unclear Source of Truth</li>
</ul>

<p>It seemed that Flux would be a perfect fit for solving our biggest problems.</p>

<h2 id="a-brief-intro-to-flux:f68a385428b3fd94e51f72ad1f78204c">A Brief Intro to Flux</h2>

<h2 id="addressing-concerns:f68a385428b3fd94e51f72ad1f78204c">Addressing Concerns</h2>

<h3 id="what-about-uikit:f68a385428b3fd94e51f72ad1f78204c">What About UIKit?</h3>

<h3 id="what-about-onboarding-new-developers:f68a385428b3fd94e51f72ad1f78204c">What About Onboarding New Developers?</h3>

<h3 id="integrating-with-existing-code:f68a385428b3fd94e51f72ad1f78204c">Integrating with Existing Code</h3>

<h2 id="6-months-in:f68a385428b3fd94e51f72ad1f78204c">6 Months In</h2>

<h2 id="conclusion:f68a385428b3fd94e51f72ad1f78204c">Conclusion</h2>









    </section>


  

      

    <footer class="post-footer">
    <section class="author">
        <h4>Benjamin Encz</h4>
        <p>Find me on twitter: <a href="https://twitter.com/benjaminencz">@benjaminencz</a>
        <p>Engineer <a href="https://www.plangrid.com/en">@PlanGrid</a> (<a href="http://grnh.se/8fcutd">We're hiring!</a>)<br></p>
    </section>

    
    <section class="share">
      <h4>Share this post</h4>
      <a class="icon-twitter" style="font-size: 1.4em" href="https://twitter.com/share?text=Real%20World%20Flux%20Architecture%20on%20iOS&amp;url=http%3a%2f%2flocalhost%3a1313%2fpost%2freal-world-flux-ios%2f"
          onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
          <span class="hidden">Twitter</span>
      </a>
      <a class="icon-facebook" style="font-size: 1.4em" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpost%2freal-world-flux-ios%2f"
          onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
          <span class="hidden">Facebook</span>
      </a>
      <a class="icon-google-plus" style="font-size: 1.4em" href="https://plus.google.com/share?url=http%3a%2f%2flocalhost%3a1313%2fpost%2freal-world-flux-ios%2f"
         onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
          <span class="hidden">Google+</span>
      </a>
    </section>
    

</footer>


    

<span id="comment_section"></span>
<div id="disqus_thread"></div>
<script type="text/javascript">

  var disqus_shortname = 'benjaminencz';
  var disqus_url = 'http:\/\/blog.benjamin-encz.de\/post\/real-world-flux-ios\/';

  if (disqus_url === undefined) {
    if (window.location.hostname == "localhost") {
        
        disqus_url = undefined;
    } else {
        disqus_url = 'http:\/\/localhost:1313\/post\/real-world-flux-ios\/';
    }
  }

  (function() {
    if (disqus_url == '' || disqus_url == undefined) {
        return
    }

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



</article>

</main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="">[Thinking inside a large box];</a> </section>
        
        <section class="poweredby">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/vjeantet/hugo-theme-casper">Casper</a> theme</section>
        
    </footer>
    </div>
    <script type="text/javascript" src="http://localhost:1313/js/jquery.js"></script>
    <script type="text/javascript" src="http://localhost:1313/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="http://localhost:1313/js/index.js"></script>
    

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-48608026-1', 'benjamin-encz.de');
      ga('send', 'pageview');
    </script>
</body>
</html>

